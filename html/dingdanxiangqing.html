<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>订单详情</title>
    <link href="https://cdn.bootcss.com/iview/2.14.0/styles/iview.css" rel="stylesheet">
    <style>
        /*页面总样式*/
        body {
            padding: 8px;
            background-color: rgb(245, 245, 245);
        }

        /*卡片样式*/
        .ivu-card {
            margin-bottom: 8px;
        }

        /*取消表格边框*/
        .ivu-table-wrapper {
            border: 0;
        }
        .ivu-table:before {
            width: 0;
        }
        .ivu-table:after {
            width: 0;
        }
    </style>
</head>
<body>
<div id="app">
    <row> <i-col span="24">
        <card dis-hover	style="text-align: center">
            <row>
                <img src="http://thyrsi.com/t6/369/1536558999x-1404750082.png" alt="" style="width: 60px; height: 60px;border-radius: 150px;">
            </row>
            <row>
                <strong style="font-size: 16px; color: #464c5b;">订单已完成</strong>
            </row>
            <row>
                <span style="font-size: 12px; color: #9ea7b4;">感谢您对铂金宫的信任，期待再次光临</span>
            </row>
            <row style="margin-top: 6px">
                <i-button>联系客服</i-button>
                <i-button type="error">评价服务</i-button>
                <i-button type="primary">再来一单</i-button>
            </row>
        </card>
    </i-col> </row>

    <row v-if="appointmentData"> <i-col span="24">
        <card dis-hover	 title="预约信息" style="font-size: 12px; color: #657180;">
            <row>预约时间: {{ appointmentData.date }}</row>
            <row>预约人数: {{ appointmentData.count }}人</row>
        </card>
    </i-col> </row>

    <row> <i-col span="24">
        <card dis-hover	 title="服务信息">
            <!--服务信息表格-->
            <i-table :columns="serviceColumns" :data="serviceData" :show-header="false" disabled-hover>
                <div slot="footer">
                    <row type="flex" justify="space-between">
                        <i-col span="12">功能按钮留空</i-col>
                        <i-col span="12">
                            <span style="float: right">
                                实付 &nbsp
                                <span style="font-size: 16px">¥{{ totalPrice }}</span>
                            </span>
                        </i-col>
                    </row>
                </div>
            </i-table>
        </card>
    </i-col> </row>

    <row> <i-col span="24">
        <card dis-hover	 title="技师信息">
            <!--技师信息表格-->
            <i-table :columns="tncColumns" :data="tncData" :show-header="false" disabled-hover></i-table>
        </card>
    </i-col> </row>

    <row> <i-col span="24">
        <card dis-hover	 title="订单信息" style="font-size: 12px; color: #657180;">
            <row>订单号: {{ orderData.id }}</row>
            <row>支付方式: {{ orderData.payment }}</row>
            <row>下单时间: {{ orderData.date }}</row>
            <row>下单用户: {{ orderData.customer }}</row>
        </card>
    </i-col> </row>
</div>
</body>
<script src="https://cdn.bootcss.com/vue/2.5.17-beta.0/vue.min.js"></script>
<script src="https://cdn.bootcss.com/iview/2.14.0/iview.min.js"></script>
<script type="text/javascript" src="../js/jquery.js"></script>
<script>

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    let Main = {
        data () {
            return {
                serviceColumns: [
                    { title: 'Name', key: 'serviceName' },  // 服务名称
                    { title: 'Counts', key: 'counts', width: 50,
                        render: (h, params) => {
                            // 筛除无数据的项目
                            if (params.row.counts) {
                                return h('div', [
                                    h('span', 'x'),
                                    h('span', params.row.counts)
                                ]);
                            }
                        },  // 自定义渲染模板
                    },  // 次数
                    { title: 'Price', key: 'servicePrice', align: 'right', width: 80,
                        render: (h, params) => {
                            return h('div', [
                                h('span', {
                                    style: { fontSize: '9px' },
                                }, '¥'),
                                h('span', params.row.servicePrice)
                            ]);
                        },  // 自定义渲染模板
                    },  // 价格
                ],  // 服务列信息
                serviceData: [
                ],  // 服务数据

                tncColumns: [

                    { title: 'RoomNum', key: 'roomNum', width: 80 },  // 包厢号
                    { title: 'Service', key: 'service', align: 'right' },  // 对应服务
                ],  // 技师列信息
                tncData: [
                ],  // 技师数据

                orderData: {
                    id: getQueryString('id'),
                    payment: '微信支付',
                    date: '2018-10-01 12:00',
                    customer: '王先生',
                },  // 订单数据

                appointmentData: null // 预约信息, 如果不是预约订单则变量值应该为null
            }
        },
        computed: {
            totalPrice () {
                let totalPrice = 0;
                this.serviceData.forEach((data)=>{
                    totalPrice += data.servicePrice * data.counts
                });
                return totalPrice;
            },  // 订单总价格
        },
        methods: {

        },
        created() {
            var that = this;
            $.post("../php/getorderdetail.php",{
                id:getQueryString('id')
            }).done((res)=>{
                res = JSON.parse(res)
                for(var i=0;i<res.length;i++){
                    that.serviceData.push({
                        serviceName: res[i].service_name, 
                        counts: 1, 
                        servicePrice: res[i].price
                    })
                    that.tncData.push({
                        tncName: res[i].name, 
                        roomNum:  res[i].job_number, 
                        service: res[i].service_name
                    })
                    if(res[i].appo === null){

                    }else{
                        that.appointmentData = res[i].appo
                    }
                    that.orderData.payment =  res[i].pay_way
                    that.orderData.date =  res[i].time
                    that.orderData.customer =  res[i].user_id
                }

            })
        },
    };
    let Component = Vue.extend(Main);
    let app = new Component().$mount('#app');
</script>
</html>